<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- 强制禁止浏览器缓存 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>NutriGuide Pro 营养素速查</title>
    
    <!-- PWA 配置 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ffffff">
    <link rel="apple-touch-icon" href="https://img.icons8.com/color/180/healthy-food.png">

    <!-- 库引入 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap" rel="stylesheet">

    <!-- Tailwind 深色模式配置 -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#10b981',
                        darkBg: '#0f172a',
                        darkCard: '#1e293b',
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* 英雄联盟风格卡片特效 */
        .hero-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .hero-card:active {
            transform: scale(0.95);
        }
        .hero-card.dimmed {
            opacity: 0.2;
            filter: grayscale(100%);
            transform: scale(0.9);
        }
        .hero-card.highlighted {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
            z-index: 10;
        }

        /* 弹窗动画 */
        .modal-enter { animation: modalIn 0.3s ease-out forwards; }
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-darkBg transition-colors duration-300 overflow-hidden fixed inset-0">
    <div id="root" class="h-full overflow-y-auto"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ================= 数据源 (增加 tags 用于症状筛选) =================
        const nutrientsData = [
            // --- 维生素 ---
            {
                id: 'va', category: 'vitamin', shortName: '维A', name: '维生素 A', nameEn: 'Vitamin A',
                tags: ['eye', 'skin', 'immune'],
                rda: '男 900mcg / 女 700mcg', ul: '3000mcg',
                interaction: '长期饮酒会耗尽肝脏VA储备；与异维A酸类药物（治痘药）同服可能导致严重中毒。',
                deficiency: '夜盲症（晚上看不清）、干眼症、皮肤干燥起鸡皮（毛囊角化）、免疫力下降易感冒。',
                excess: '急性中毒（恶心、剧烈呕吐、头痛），慢性中毒（肝损伤、骨骼疼痛、脱发）、孕妇过量可致胎儿畸形。',
                seniorAdvice: '老年人肝脏代谢能力变慢，非常容易发生维生素A蓄积中毒。请避免长期大量服用鱼肝油，优先吃胡萝卜、南瓜、红薯，因为植物性的β-胡萝卜素非常安全，身体需要多少转化多少。',
                sources: '动物肝脏、鱼肝油、胡萝卜、红薯、菠菜。',
                sourceRef: 'NIH Office of Dietary Supplements'
            },
            {
                id: 'vd', category: 'vitamin', shortName: '维D', name: '维生素 D', nameEn: 'Vitamin D',
                tags: ['bone', 'immune', 'mood'],
                rda: '600-800 IU (70岁以上建议更高)', ul: '4000 IU',
                interaction: '皮质类固醇（激素类药物）会降低VD吸收；VD的代谢和发挥作用必须要有“镁”的参与，缺镁补D效果差。',
                deficiency: '骨质疏松、肌肉无力、容易骨折、情绪抑郁、免疫力低下、脱发。',
                excess: '高钙血症（表现为恶心、极度口渴、尿频、便秘）、肾结石风险增加、软组织和血管钙化。',
                seniorAdvice: '非常重要！老年人皮肤合成VD能力大幅下降，且户外活动少。缺乏VD是老年人跌倒和骨折的主要原因。建议去医院检测血清25(OH)D水平，并遵医嘱补充VD3，同时配合维生素K2以引导钙入骨。',
                sources: '阳光照射、富脂鱼类（鲑鱼）、蛋黄、强化牛奶。',
                sourceRef: 'Mayo Clinic / NIH'
            },
            {
                id: 've', category: 'vitamin', shortName: '维E', name: '维生素 E', nameEn: 'Vitamin E',
                tags: ['skin', 'blood'],
                rda: '15mg', ul: '1000mg',
                interaction: '它有抗凝血作用，服用华法林、阿司匹林等抗凝药的人如果大量补充VE，会增加出血风险。',
                deficiency: '平时很罕见。主要见于吸收不良者，表现为溶血性贫血、走路不稳（神经损伤）、视网膜病变。',
                excess: '虽然相对安全，但长期超大剂量可能增加出血性中风风险，甚至增加全因死亡率。',
                seniorAdvice: '不要为了“抗衰老”而盲目大剂量吃维生素E胶囊。最好的方式是吃坚果和植物油。手术前两周应停用VE补充剂。',
                sources: '杏仁、葵花籽、植物油、鳄梨、菠菜。',
                sourceRef: 'NIH / Harvard Health'
            },
            {
                id: 'vk', category: 'vitamin', shortName: '维K', name: '维生素 K', nameEn: 'Vitamin K',
                tags: ['bone', 'blood'],
                rda: '男 120mcg / 女 90mcg', ul: '未设定',
                interaction: '它是华法林（抗凝药）的死对头！服用华法林期间必须保持饮食中绿叶菜摄入量的稳定，忽多忽少会要命。',
                deficiency: '凝血困难（流鼻血、牙龈出血难止）、骨质疏松、动脉钙化（K2缺乏）。',
                excess: '天然形式毒性很低。但人工合成的K3可能有毒性（已禁用）。',
                seniorAdvice: 'K2对老年人尤其重要，它能把血管里的钙“搬运”到骨头里，既预防骨质疏松又预防血管硬化。纳豆是K2之王。',
                sources: 'K1: 绿叶蔬菜(羽衣甘蓝); K2: 纳豆、奶酪、蛋黄。',
                sourceRef: 'NIH ODS'
            },
            {
                id: 'vb1', category: 'vitamin', shortName: 'B1', name: '维生素 B1', nameEn: 'Thiamine',
                tags: ['energy', 'brain'],
                rda: '男 1.2mg / 女 1.1mg', ul: '未设定 (安全)',
                interaction: '长期服用利尿剂（降压药）会导致B1随尿液流失；大量饮茶或咖啡中的单宁酸会阻碍吸收。',
                deficiency: '脚气病（下肢水肿）、严重疲劳、厌食、韦尼克脑病（突然的精神错乱、记忆丧失，常见于酗酒者）。',
                excess: '水溶性，肾脏排出快，极罕见中毒。',
                seniorAdvice: '老年人如果长期吃精米白面、喝粥咸菜，非常容易缺乏B1，表现为没胃口、便秘、腿脚无力。',
                sources: '猪肉（含量高）、全谷物、糙米、豆类。',
                sourceRef: 'NIH ODS'
            },
            {
                id: 'vb2', category: 'vitamin', shortName: 'B2', name: '维生素 B2', nameEn: 'Riboflavin',
                tags: ['eye', 'skin'],
                rda: '男 1.3mg / 女 1.1mg', ul: '未设定',
                interaction: '某些抗抑郁药和抗癌药会干扰B2代谢。',
                deficiency: '最典型的是“烂嘴角”（口角炎）、舌头红肿疼痛、眼睛怕光流泪、阴囊皮炎。',
                excess: '无毒，过量会让尿液呈现亮黄色（荧光黄），这是正常现象不用担心。',
                seniorAdvice: '老年人如果长期不喝奶、不吃肉，容易缺乏。B2缺乏常与B6缺乏同时发生。',
                sources: '牛奶、酸奶、内脏、鸡蛋、蘑菇。',
                sourceRef: 'NIH ODS'
            },
            {
                id: 'vb3', category: 'vitamin', shortName: 'B3', name: '维生素 B3', nameEn: 'Niacin',
                tags: ['skin', 'brain'],
                rda: '男 16mg / 女 14mg', ul: '35mg (指补充剂)',
                interaction: '异烟肼（抗结核药）会造成B3缺乏；高剂量B3会加重痛风。',
                deficiency: '糙皮病（皮肤暴露处粗糙发黑）、舌炎、腹泻、严重时会导致痴呆。',
                excess: '皮肤潮红（脸红发热、刺痛）、肝损伤、血糖升高、尿酸升高。',
                seniorAdvice: '有些老年人为了降血脂自行服用高剂量烟酸，这非常危险，可能损伤肝脏，必须在医生指导下使用。',
                sources: '鸡胸肉、金枪鱼、花生、牛肉。',
                sourceRef: 'Mayo Clinic'
            },
            {
                id: 'vb6', category: 'vitamin', shortName: 'B6', name: '维生素 B6', nameEn: 'Pyridoxine',
                tags: ['brain', 'mood', 'skin'],
                rda: '1.7mg (50岁以上)', ul: '100mg',
                interaction: '左旋多巴（帕金森药）效果会被B6降低；异烟肼会消耗B6。',
                deficiency: '皮炎、舌头光滑疼痛、抑郁、贫血、免疫力低。',
                excess: '长期大剂量（每天超过100mg）会导致严重的神经损伤，表现为手脚麻木、走路像踩棉花，且这种损伤很难恢复。',
                seniorAdvice: '老年人对B6的需求量比年轻人高。补充B6一定要控制剂量，千万别当成补品随便吃，神经毒性风险是真实的。',
                sources: '鹰嘴豆、金枪鱼、鸡肉、土豆、香蕉。',
                sourceRef: 'NIH ODS'
            },
            {
                id: 'vb9', category: 'vitamin', shortName: '叶酸', name: '维生素 B9 (叶酸)', nameEn: 'Folate',
                tags: ['blood', 'brain'],
                rda: '400mcg', ul: '1000mcg',
                interaction: '甲氨蝶呤（治类风湿、癌症）是叶酸拮抗剂；抗癫痫药会降低叶酸水平。',
                deficiency: '巨幼细胞贫血（红细胞变大）、虚弱、舌炎、孕期胎儿神经管畸形。',
                excess: '过量补充叶酸会“掩盖”维生素B12缺乏的早期症状，导致B12缺乏引起的神经损伤在不知不觉中恶化。',
                seniorAdvice: '老年人在补充叶酸前，最好先确认B12水平是否正常。如果只补叶酸不补B12，对神经系统保护不利。',
                sources: '深绿色蔬菜（菠菜）、芦笋、动物肝脏、豆类。',
                sourceRef: 'NIH ODS'
            },
            {
                id: 'vb12', category: 'vitamin', shortName: 'B12', name: '维生素 B12', nameEn: 'Cobalamin',
                tags: ['brain', 'blood', 'energy'],
                rda: '2.4mcg', ul: '未设定',
                interaction: '二甲双胍（降糖药）和奥美拉唑（胃药）会显著阻碍B12吸收，长期服用者必须监测。',
                deficiency: '恶性贫血、神经损伤（手脚麻木、刺痛、平衡感差）、记忆力减退、痴呆样症状。',
                excess: '几乎无毒性，多余的会随尿排出。',
                seniorAdvice: '约30%的老年人因萎缩性胃炎导致胃酸不足，根本无法从食物中吸收B12。建议老年人直接吃B12补充剂（甲钴胺）或强化食品，因为补充剂不需要胃酸消化就能吸收。',
                sources: '蛤蜊、肝脏、鱼、肉、蛋、奶（植物性食物几乎不含）。',
                sourceRef: 'USDA / Mayo Clinic'
            },
            {
                id: 'vc', category: 'vitamin', shortName: '维C', name: '维生素 C', nameEn: 'Vitamin C',
                tags: ['immune', 'skin'],
                rda: '男 90mg / 女 75mg', ul: '2000mg',
                interaction: '能促进铁的吸收（好事）；大剂量VC可能会干扰华法林的效果。',
                deficiency: '坏血病（牙龈肿胀出血、牙齿松动、皮下瘀斑）、伤口愈合慢、关节痛。',
                excess: '腹泻、恶心、胃痉挛。对于有草酸钙结石病史的人，大剂量VC会增加肾结石复发风险。',
                seniorAdvice: '老年人常因不吃新鲜水果导致摄入不足。不建议口服极高剂量的VC（如每天好几克），吸收率低且伤胃，还可能增加肾结石风险。',
                sources: '红辣椒（含量极高）、番石榴、猕猴桃、柑橘、西兰花。',
                sourceRef: 'NIH ODS'
            },

            // --- 矿物质 ---
            {
                id: 'ca', category: 'mineral', shortName: '钙', name: '钙', nameEn: 'Calcium',
                tags: ['bone', 'muscle'],
                rda: '1000-1200mg', ul: '2000-2500mg',
                interaction: '高剂量钙会抑制铁、锌的吸收（最好分开吃）；钙吸收依赖维生素D；四环素类抗生素需避开钙服用。',
                deficiency: '长期缺乏导致骨质疏松、佝偻病。急性缺乏会导致手足抽搐、肌肉痉挛、心律失常。',
                excess: '便秘、肾结石（主要源于补充剂而非食物）、干扰其他矿物质吸收、高钙血症。',
                seniorAdvice: '补钙首选食补（牛奶、酸奶）。如果必须吃钙片，建议单次剂量不要超过500mg（因为单次吸收有限），且最好随餐服用。切记：没有维生素D，补再多钙也吸收不了！',
                sources: '奶制品、沙丁鱼（带骨）、豆腐、深绿色蔬菜。',
                sourceRef: 'NOF (National Osteoporosis Foundation)'
            },
            {
                id: 'mg', category: 'mineral', shortName: '镁', name: '镁', nameEn: 'Magnesium',
                tags: ['sleep', 'muscle', 'mood', 'bone'],
                rda: '男 420mg / 女 320mg', ul: '350mg (仅限补充剂摄入量)',
                interaction: '利尿剂、质子泵抑制剂（胃药）是“镁强盗”；镁和钙在体内有竞争也有协同，建议比例2:1。',
                deficiency: '肌肉震颤、抽筋（特别是腿抽筋）、失眠、心律失常、偏头痛、焦虑。',
                excess: '食物来源几乎不会中毒。补充剂过量会导致腹泻（氧化镁常用作泻药）、恶心，严重时导致低血压和心脏骤停。',
                seniorAdvice: '很多老年人失眠、便秘、腿抽筋其实是缺镁。补充甘氨酸镁或柠檬酸镁吸收较好，氧化镁吸收差且容易拉肚子。肾功能不全者补充镁必须遵医嘱！',
                sources: '南瓜籽、菠菜、黑豆、黑巧克力、巴旦木。',
                sourceRef: 'NIH ODS'
            },
            {
                id: 'k', category: 'mineral', shortName: '钾', name: '钾', nameEn: 'Potassium',
                tags: ['heart', 'muscle'],
                rda: '男 3400mg / 女 2600mg', ul: '未设定（肾脏正常时）',
                interaction: 'ACEI/ARB类降压药、保钾利尿剂会导致血钾升高，此时严禁额外补钾。',
                deficiency: '严重的肌无力、疲劳、便秘、心律失常（甚至心脏骤停）。',
                excess: '高钾血症（极度危险，可能无症状突然心脏停跳）。主要见于肾衰竭患者或服用特定药物者。',
                seniorAdvice: '随着年龄增长，肾功能自然衰退，排钾能力变弱。老年人多吃蔬菜水果补钾通常是安全的且有助降血压，但绝对不要自己随意吃“钾片”或大量使用低钠盐（高钾盐），除非医生允许。',
                sources: '土豆、红薯、香蕉、菠菜、鳄梨。',
                sourceRef: 'AHA / NIH'
            },
            {
                id: 'na', category: 'mineral', shortName: '钠', name: '钠', nameEn: 'Sodium',
                tags: ['heart'],
                rda: '建议 <2300mg (约6克盐)', ul: '越少越好',
                interaction: '高钠会导致钙流失（骨质疏松帮凶）；钾可以对抗钠的升压作用。',
                deficiency: '低钠血症（恶心、头痛、意识模糊、抽搐）。老年人常见原因：利尿剂副作用、出汗后只喝白水不补电解质。',
                excess: '高血压、中风、心脏病、胃癌风险增加、加重骨质疏松。',
                seniorAdvice: '老年人味觉退化，容易觉得菜淡而多放盐。建议用醋、蒜、辣椒等天然香料替代盐来提味。警惕“隐形盐”（酱油、味精、加工食品）。',
                sources: '食盐、酱油、腌制食品、加工肉类。',
                sourceRef: 'CDC / WHO'
            },

            // --- 微量元素 ---
            {
                id: 'fe', category: 'trace', shortName: '铁', name: '铁', nameEn: 'Iron',
                tags: ['blood', 'energy'],
                rda: '男 8mg / 女 18mg (50岁后降为8mg)', ul: '45mg',
                interaction: '茶和咖啡中的多酚阻碍铁吸收；维生素C促进铁吸收；钙片会抑制铁吸收（要分开吃）。',
                deficiency: '缺铁性贫血（脸色苍白、乏力、指甲凹陷变脆、爬楼梯气喘）、免疫力低。',
                excess: '铁是强氧化剂，过量会沉积在肝脏、心脏、胰腺，导致肝硬化、心脏损伤、肤色变黑（青铜色糖尿病）。',
                seniorAdvice: '特别提醒：绝经后女性和老年男性不再失血，对铁的需求量很低。除非确诊缺铁性贫血，否则**千万不要**吃含铁的复合维生素或铁剂，过量的铁会加速衰老和慢性病。',
                sources: '红肉、动物肝脏、血制品、强化谷物。',
                sourceRef: 'NIH ODS'
            },
            {
                id: 'zn', category: 'trace', shortName: '锌', name: '锌', nameEn: 'Zinc',
                tags: ['immune', 'skin'],
                rda: '男 11mg / 女 8mg', ul: '40mg',
                interaction: '长期高锌 (>50mg/天) 会抑制铜的吸收，导致铜缺乏；会降低四环素和喹诺酮类抗生素药效。',
                deficiency: '味觉嗅觉减退（吃东西没味）、伤口愈合慢、脱发、免疫力差、皮炎。',
                excess: '恶心、呕吐、免疫功能反而受损、好胆固醇（HDL）降低、铜缺乏性贫血。',
                seniorAdvice: '许多老年人食欲不振、吃不出味道，其实是缺锌。适当补锌可以改善食欲和免疫，但切记不要超量，锌补多了会引起铜缺乏，建议选择含少量铜的锌补剂。',
                sources: '牡蛎（含量极高）、牛肉、螃蟹、南瓜籽。',
                sourceRef: 'Mayo Clinic'
            },
            {
                id: 'se', category: 'trace', shortName: '硒', name: '硒', nameEn: 'Selenium',
                tags: ['immune'],
                rda: '55mcg', ul: '400mcg',
                interaction: '与维生素E协同抗氧化；对甲状腺激素的代谢至关重要。',
                deficiency: '克山病（心肌病）、大骨节病、甲状腺功能减退、免疫力下降。',
                excess: '硒中毒（呼气有大蒜味、头发指甲变脆脱落、皮疹、疲劳、神经损伤）。',
                seniorAdvice: '硒的安全窗口很窄！补硒一定要计算总量。如果你每天吃2个巴西坚果，硒就可能超标了。不建议长期长期服用高剂量硒补充剂，除非有医嘱。',
                sources: '巴西坚果（含量极高）、金枪鱼、沙丁鱼、虾。',
                sourceRef: 'NIH ODS'
            },
            {
                id: 'i', category: 'trace', shortName: '碘', name: '碘', nameEn: 'Iodine',
                tags: ['energy'],
                rda: '150mcg', ul: '1100mcg',
                interaction: '缺硒会加重碘缺乏的影响；十字花科蔬菜生吃过多可能阻碍碘吸收（煮熟没事）。',
                deficiency: '甲状腺肿大（大脖子病）、甲减（怕冷、乏力、体重增加、反应迟钝）。',
                excess: '诱发甲亢、自身免疫性甲状腺炎（桥本氏病）、甲状腺乳头状癌风险增加。',
                seniorAdvice: '老年人甲状腺结节高发。如果有自身免疫性甲状腺疾病（如桥本），可能需要限制碘摄入（少吃海带紫菜）。具体请遵医嘱。',
                sources: '海带、紫菜、海鱼、加碘盐、奶制品。',
                sourceRef: 'NIH ODS'
            },
            {
                id: 'cu', category: 'trace', shortName: '铜', name: '铜', nameEn: 'Copper',
                tags: ['blood', 'bone'],
                rda: '900mcg', ul: '10000mcg',
                interaction: '高剂量的锌会强力抑制铜吸收；高剂量的维生素C也可能降低铜水平。',
                deficiency: '贫血（补铁也好不了）、白细胞减少（易感染）、骨质疏松、神经病变。',
                excess: '肝脏损伤、肾衰竭、胃肠道症状。威尔逊氏病患者无法排泄铜，必须忌口。',
                seniorAdvice: '一般饮食不缺铜。但如果你长期补锌（例如为了前列腺健康），必须关注铜的摄入，最好每补15-30mg锌就配1-2mg铜。',
                sources: '牛肝、牡蛎、香菇、黑巧克力、腰果。',
                sourceRef: 'NIH ODS'
            },
            {
                id: 'mn', category: 'trace', shortName: '锰', name: '锰', nameEn: 'Manganese',
                tags: ['bone'],
                rda: '男 2.3mg / 女 1.8mg', ul: '11mg',
                interaction: '铁和锰在吸收上有竞争关系；镁和钙的制酸剂可能减少锰吸收。',
                deficiency: '罕见。可能导致骨骼畸形、糖耐量受损、皮疹。',
                excess: '神经毒性（类似帕金森病的症状，如震颤、僵硬），主要见于职业暴露或肝病患者无法排泄锰。',
                seniorAdvice: '锰主要经胆汁排泄。如果有严重肝病或胆道梗阻的老年人，要避免摄入过量锰。全谷物和茶叶中锰含量较高。',
                sources: '全谷物、蛤蜊、坚果、茶叶。',
                sourceRef: 'NIH ODS'
            }
        ];

        // 症状映射表
        const symptomMap = [
            { id: 'sleep', label: '😴 失眠/焦虑', desc: '助眠、放松神经' },
            { id: 'bone', label: '🦴 骨骼/关节', desc: '强健骨骼、防抽筋' },
            { id: 'eye', label: '👀 护眼/视力', desc: '缓解干涩、夜盲' },
            { id: 'immune', label: '🛡️ 免疫/感冒', desc: '增强抵抗力' },
            { id: 'energy', label: '⚡ 精力/疲劳', desc: '提升活力、抗疲劳' },
            { id: 'skin', label: '✨ 皮肤/抗衰', desc: '美白、抗氧化' },
            { id: 'blood', label: '🩸 贫血/头晕', desc: '造血功能' },
            { id: 'heart', label: '❤️ 心脏/血压', desc: '心血管健康' },
            { id: 'muscle', label: '💪 肌肉/力量', desc: '防抽筋、增肌' },
            { id: 'brain', label: '🧠 记忆/神经', desc: '神经保护、防痴呆' },
        ];

        const guidelinesData = [
            {
                title: "酒精：能不喝就不喝",
                highlight: "⚠️ 重大改变",
                content: "以前说'适量饮酒有益健康'的说法已经过时了。2026指南明确指出：哪怕喝一点点，也会增加癌症（食道癌、乳腺癌等）和心血管病的风险。如果你现在不喝酒，千万别开始；如果你喝酒，男的一天别超2杯，女的别超1杯，最好完全戒掉。",
                seniorNote: "老年人身体含水量少，代谢酒精特别慢，一杯倒。而且酒精会和你的降压药、止痛药、安眠药发生致命的反应。为了脑子不糊涂，别喝了。",
                source: "USDA / NIAAA 2026"
            },
            {
                title: "糖：不仅要少吃，还要防'隐形糖'",
                highlight: "🚫 严格控糖",
                content: "新指南建议把添加糖控制在总热量的6%以内（以前是10%）。这意味着一瓶可乐就超标了。不仅是糖果，还要小心面包、沙拉酱、酸奶里的隐形糖。高糖是炎症之源，会加速身体衰老。",
                seniorNote: "随着年龄增长，胰岛素功能变差，高糖饮食会直接导致糖尿病风险飙升，还会由于'糖化反应'让皮肤变皱、血管变硬、认知能力下降。",
                source: "AHA / USDA"
            },
            {
                title: "蛋白质：老年人更要多吃肉蛋奶",
                highlight: "💪 对抗肌肉流失",
                content: "这与年轻人的建议不同！人老了，对蛋白质吸收变差，而且容易肌肉萎缩（少肌症），导致走路不稳摔跤。年轻人每公斤体重吃0.8克蛋白就够，老年人建议吃到1.2克以上。",
                seniorNote: "别光喝粥吃咸菜！每顿饭（早中晚）都要有掌心大小的蛋白质（鸡蛋、牛奶、鱼、瘦肉、豆腐）。把蛋白质分散到三餐吃，比一顿大餐吸收效果好得多。",
                source: "PROT-AGE Study Group"
            },
            {
                title: "超加工食品：这是'假食物'，少吃",
                highlight: "🛑 炎症源头",
                content: "超市里那些包装精美、配料表一长串、你在厨房里找不到的成分（如改性淀粉、高果糖浆）的食品，就是超加工食品。它们好吃但没营养，还会让你发胖、发炎、患癌。",
                seniorNote: "方便面、火腿肠、速冻丸子、饼干蛋糕，这些东西尽量移出你的购物清单。多买'原本样子的食物'，比如买新鲜猪肉而不是午餐肉，买水果而不是果汁。",
                source: "BMJ / NIH"
            },
            {
                title: "盐和钾：换种盐，降血压",
                highlight: "⚖️ 2:1 黄金比",
                content: "现代人盐（钠）吃太多，钾吃太少，这是高血压的主因。指南建议：少吃咸的，多吃富含钾的蔬菜水果。如果能做到钠钾平衡，对控制血压的效果堪比吃药。",
                seniorNote: "一个简单的方法：如果你的肾功能正常，家里可以换用'低钠盐'（里面加了钾）。但注意：如果有肾病或正在服用保钾利尿剂，千万别用低钠盐，也别乱补钾，必须问医生！",
                source: "DASH Diet / AHA"
            },
            {
                title: "脂肪：别怕脂肪，但要选对",
                highlight: "🥑 优质脂肪",
                content: "不要因为怕胖就滴油不沾。大脑和细胞膜都需要脂肪。要少吃'饱和脂肪'（猪大油、肥肉、奶油），完全不吃'反式脂肪'（代可可脂、起酥油），多吃'不饱和脂肪'。",
                seniorNote: "多吃鱼（深海鱼油）、橄榄油、茶油、坚果。这些'好脂肪'能保护你的心血管，还能改善老年人的记忆力。",
                source: "Harvard Health"
            }
        ];

        const sourcesInfo = [
            { 
                name: "NIH ODS (美国国立卫生研究院)", 
                desc: "Office of Dietary Supplements. 美国联邦政府下属的最高医学研究机构，其数据代表了全球最严谨、客观的科学共识，绝无任何商业利益干扰。是医生和科学家参考的金标准。" 
            },
            { 
                name: "Mayo Clinic (梅奥诊所)", 
                desc: "梅奥诊所（Mayo Clinic）。连续多年蝉联'世界最佳医院'排行榜榜首。其建议汇集了全球顶尖医生的临床经验，不仅科学，更注重患者的安全与实际应用。" 
            },
            { 
                name: "USDA 2025-2030 DGA", 
                desc: "美国农业部（USDA）与卫生部联合发布。每五年更新一次的《美国居民膳食指南》是美国国家营养政策的法律基础，由顶级科学家组成的咨询委员会基于最新科研成果制定。" 
            },
            { 
                name: "LPI (莱纳斯·鲍林研究所)", 
                desc: "莱纳斯·鲍林研究所（Linus Pauling Institute）。由诺贝尔奖得主创立，是全球微量营养素研究的圣地，专注于研究维生素如何预防疾病和延缓衰老，数据极其专业详尽。" 
            }
        ];

        // ================= 组件 =================

        // --- 1. 英雄网格卡片 ---
        const HeroCard = ({ item, isDimmed, isHighlighted, onClick }) => {
            const colors = {
                vitamin: 'from-blue-500 to-blue-600 shadow-blue-200 dark:shadow-blue-900/30',
                mineral: 'from-emerald-500 to-emerald-600 shadow-emerald-200 dark:shadow-emerald-900/30',
                trace: 'from-purple-500 to-purple-600 shadow-purple-200 dark:shadow-purple-900/30'
            };

            return (
                <div 
                    onClick={onClick}
                    className={`
                        hero-card relative aspect-square rounded-2xl p-2 cursor-pointer
                        bg-gradient-to-br ${colors[item.category]}
                        flex flex-col items-center justify-center text-white
                        shadow-lg border border-white/10
                        ${isDimmed ? 'dimmed' : ''}
                        ${isHighlighted ? 'highlighted' : ''}
                    `}
                >
                    <div className="text-3xl font-black mb-1 drop-shadow-md">{item.shortName}</div>
                    <div className="text-[10px] opacity-90 font-medium tracking-wide text-center leading-tight">{item.nameEn}</div>
                    <div className="absolute top-2 right-2 w-2 h-2 rounded-full bg-white/40"></div>
                </div>
            );
        };

        // --- 2. 详情弹窗 (Modal) ---
        const DetailModal = ({ item, onClose, isSeniorMode, setIsSeniorMode }) => {
            if (!item) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 modal-enter" onClick={onClose}>
                    <div 
                        className={`bg-white dark:bg-darkCard w-full max-w-2xl max-h-[90vh] rounded-3xl shadow-2xl overflow-hidden flex flex-col relative`}
                        onClick={e => e.stopPropagation()}
                    >
                        <div className="bg-slate-50 dark:bg-slate-800/50 p-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center shrink-0">
                            <div>
                                <h2 className="text-2xl font-bold text-slate-800 dark:text-white">{item.name}</h2>
                                <p className="text-sm text-slate-500 dark:text-slate-400">{item.nameEn}</p>
                            </div>
                            <div className="flex gap-2">
                                <button 
                                    onClick={() => setIsSeniorMode(!isSeniorMode)}
                                    className={`px-3 py-1.5 rounded-full text-sm font-bold transition-colors ${
                                        isSeniorMode 
                                        ? 'bg-yellow-100 text-yellow-800 ring-2 ring-yellow-400 dark:bg-yellow-900 dark:text-yellow-200' 
                                        : 'bg-white border border-slate-200 text-slate-500 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-300'
                                    }`}
                                >
                                    {isSeniorMode ? '大字版开' : '大字版'}
                                </button>
                                <button onClick={onClose} className="w-9 h-9 flex items-center justify-center rounded-full bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-white hover:bg-slate-300 transition-colors">
                                    <i className="fa-solid fa-xmark text-lg"></i>
                                </button>
                            </div>
                        </div>

                        <div className="overflow-y-auto p-5">
                            <div className={`space-y-6 ${isSeniorMode ? 'text-2xl leading-loose tracking-wide' : 'text-base leading-relaxed'}`}>
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="bg-slate-50 dark:bg-slate-800 p-3 rounded-xl border border-slate-100 dark:border-slate-700">
                                        <span className="text-xs text-slate-500 block mb-1">推荐摄入 (RDA)</span>
                                        <span className={`font-bold text-primary dark:text-blue-400 ${isSeniorMode ? 'text-xl' : 'text-lg'}`}>{item.rda}</span>
                                    </div>
                                    <div className="bg-slate-50 dark:bg-slate-800 p-3 rounded-xl border border-slate-100 dark:border-slate-700">
                                        <span className="text-xs text-slate-500 block mb-1">耐受上限 (UL)</span>
                                        <span className={`font-bold text-danger dark:text-red-400 ${isSeniorMode ? 'text-xl' : 'text-lg'}`}>{item.ul}</span>
                                    </div>
                                </div>

                                {[
                                    { title: '相互作用', icon: 'fa-right-left', color: 'indigo', content: item.interaction },
                                    { title: '缺乏症状', icon: 'fa-arrow-trend-down', color: 'red', content: item.deficiency },
                                    { title: '过量/中毒', icon: 'fa-triangle-exclamation', color: 'orange', content: item.excess },
                                    { title: '食物来源', icon: 'fa-leaf', color: 'green', content: item.sources },
                                ].map((sec, idx) => (
                                    <div key={idx} className={`p-4 rounded-xl bg-${sec.color}-50 dark:bg-${sec.color}-900/20 border border-${sec.color}-100 dark:border-${sec.color}-800/50`}>
                                        <h4 className={`font-bold text-${sec.color}-700 dark:text-${sec.color}-300 flex items-center gap-2 mb-2 ${isSeniorMode ? 'text-3xl' : 'text-lg'}`}>
                                            <i className={`fa-solid ${sec.icon}`}></i> {sec.title}
                                        </h4>
                                        <p className="text-slate-700 dark:text-slate-300">{sec.content}</p>
                                    </div>
                                ))}

                                <div className={`p-5 rounded-xl border-l-4 shadow-sm ${isSeniorMode ? 'bg-yellow-50 dark:bg-yellow-900/20 border-yellow-400' : 'bg-slate-50 dark:bg-slate-800 border-slate-300'}`}>
                                    <h4 className={`font-bold flex items-center gap-2 mb-3 ${isSeniorMode ? 'text-yellow-800 dark:text-yellow-400 text-3xl' : 'text-slate-700 dark:text-slate-300 text-lg'}`}>
                                        <i className="fa-solid fa-user-doctor"></i> 老年人特别提醒
                                    </h4>
                                    <p className="text-slate-800 dark:text-slate-200 font-medium">{item.seniorAdvice}</p>
                                </div>

                                <p className="text-xs text-right text-slate-400 dark:text-slate-600">信息来源: {item.sourceRef}</p>
                            </div>
                        </div>

                        <div className="p-4 border-t border-slate-100 dark:border-slate-700 shrink-0 bg-white dark:bg-darkCard">
                            <button onClick={onClose} className="w-full bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-white font-bold py-3 rounded-xl transition-colors text-lg">
                                关闭
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 3. 膳食指南卡片 (修正：支持大字版) ---
        const GuidelineCard = ({ item, isSeniorMode }) => (
            <div className="bg-white dark:bg-darkCard rounded-2xl p-5 mb-4 border border-slate-100 dark:border-slate-700 shadow-sm">
                <div className="flex items-center gap-3 mb-3">
                    <span className="bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 px-3 py-1 rounded-full text-xs font-bold whitespace-nowrap">
                        {item.highlight}
                    </span>
                    <span className="text-xs text-slate-400 dark:text-slate-500">{item.source}</span>
                </div>
                <h3 className={`font-bold text-slate-800 dark:text-white mb-2 transition-all ${isSeniorMode ? 'text-3xl' : 'text-xl'}`}>{item.title}</h3>
                <p className={`text-slate-600 dark:text-slate-300 mb-4 transition-all ${isSeniorMode ? 'text-xl leading-loose tracking-wide' : 'text-base leading-relaxed'}`}>{item.content}</p>
                <div className="bg-slate-50 dark:bg-slate-800 p-3 rounded-lg border-l-4 border-yellow-400">
                    <p className={`text-slate-500 dark:text-slate-400 font-bold mb-1 transition-all ${isSeniorMode ? 'text-lg' : 'text-sm'}`}><i className="fa-solid fa-user-check"></i> 老年人注意：</p>
                    <p className={`text-slate-700 dark:text-slate-200 transition-all ${isSeniorMode ? 'text-lg' : 'text-sm'}`}>{item.seniorNote}</p>
                </div>
            </div>
        );

        // --- 4. 信源弹窗 (修正：支持大字版) ---
        const SourcesModal = ({ onClose, isSeniorMode }) => (
            <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={onClose}>
                <div className={`bg-white dark:bg-darkCard w-full rounded-2xl p-6 shadow-xl transition-all ${isSeniorMode ? 'max-w-2xl' : 'max-w-md'}`} onClick={e => e.stopPropagation()}>
                    <div className="flex justify-between items-center mb-4">
                        <h3 className={`font-bold text-slate-800 dark:text-white transition-all ${isSeniorMode ? 'text-3xl' : 'text-xl'}`}>权威信息来源</h3>
                        <button onClick={onClose} className="text-slate-400 hover:text-slate-600"><i className={`fa-solid fa-xmark transition-all ${isSeniorMode ? 'text-3xl' : 'text-xl'}`}></i></button>
                    </div>
                    <div className="space-y-4">
                        {sourcesInfo.map((source, index) => (
                            <div key={index} className="border-b border-slate-100 dark:border-slate-700 pb-3 last:border-0">
                                <h4 className={`font-bold text-primary dark:text-blue-400 mb-1 transition-all ${isSeniorMode ? 'text-2xl' : 'text-sm'}`}>{source.name}</h4>
                                <p className={`text-slate-600 dark:text-slate-300 leading-relaxed transition-all ${isSeniorMode ? 'text-xl' : 'text-xs'}`}>{source.desc}</p>
                            </div>
                        ))}
                    </div>
                    <button onClick={onClose} className={`w-full mt-4 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-white rounded-xl font-bold transition-all ${isSeniorMode ? 'text-2xl py-4' : 'text-sm py-2'}`}>关闭</button>
                </div>
            </div>
        );

        // --- 主程序 ---
        const App = () => {
            const [view, setView] = useState('nutrients');
            const [activeSymptom, setActiveSymptom] = useState(null);
            const [selectedNutrient, setSelectedNutrient] = useState(null);
            const [isSeniorMode, setIsSeniorMode] = useState(false);
            const [showSources, setShowSources] = useState(false);
            const [isDark, setIsDark] = useState(false);

            useEffect(() => {
                if (isDark) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [isDark]);

            return (
                <div className="min-h-screen pb-20">
                    
                    {/* Header */}
                    <header className="sticky top-0 z-40 bg-white/95 dark:bg-darkBg/95 backdrop-blur-md border-b border-slate-200 dark:border-slate-800">
                        <div className="max-w-3xl mx-auto px-4 py-3">
                            <div className="flex justify-between items-center mb-4">
                                <div>
                                    <h1 className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">
                                        <i className="fa-solid fa-seedling text-green-500 mr-2"></i>NutriGuide
                                    </h1>
                                    <p className="text-[10px] text-slate-400 font-medium tracking-wide">By Hao Guo</p>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => setIsDark(!isDark)} className="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-yellow-400 flex items-center justify-center">
                                        <i className={`fa-solid ${isDark ? 'fa-sun' : 'fa-moon'}`}></i>
                                    </button>
                                    <button onClick={() => setShowSources(true)} className="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-blue-400">
                                        <i className="fa-solid fa-circle-info"></i>
                                        <span className="text-xs font-bold">来源</span>
                                    </button>
                                     <button 
                                        onClick={() => setIsSeniorMode(!isSeniorMode)}
                                        className={`flex items-center gap-2 px-3 py-1.5 rounded-full transition-colors ${
                                            isSeniorMode 
                                            ? 'bg-yellow-100 text-yellow-800 ring-2 ring-yellow-400 dark:bg-yellow-900 dark:text-yellow-200' 
                                            : 'bg-slate-100 text-slate-500 dark:bg-slate-700 dark:text-slate-300'
                                        }`}
                                    >
                                        <i className="fa-solid fa-glasses"></i>
                                        <span className="text-sm font-bold">{isSeniorMode ? '大字版' : '标准'}</span>
                                    </button>
                                </div>
                            </div>

                            {/* View Tabs */}
                            <div className="flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl mb-3">
                                <button onClick={() => setView('nutrients')} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${view === 'nutrients' ? 'bg-white dark:bg-slate-600 text-primary shadow-sm' : 'text-slate-400'}`}>
                                    营养素
                                </button>
                                <button onClick={() => setView('guidelines')} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${view === 'guidelines' ? 'bg-white dark:bg-slate-600 text-primary shadow-sm' : 'text-slate-400'}`}>
                                    2026 指南
                                </button>
                            </div>

                            {/* 症状筛选条 (仅在营养素视图) */}
                            {view === 'nutrients' && (
                                <div className="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                                    <button 
                                        onClick={() => setActiveSymptom(null)}
                                        className={`whitespace-nowrap px-4 py-1.5 rounded-full text-sm font-bold transition-all ${activeSymptom === null ? 'bg-slate-800 text-white dark:bg-white dark:text-slate-900' : 'bg-slate-100 text-slate-500 dark:bg-slate-800 dark:text-slate-400'}`}
                                    >
                                        全部
                                    </button>
                                    {symptomMap.map(sym => (
                                        <button 
                                            key={sym.id}
                                            onClick={() => setActiveSymptom(activeSymptom === sym.id ? null : sym.id)}
                                            className={`whitespace-nowrap px-4 py-1.5 rounded-full text-sm font-bold transition-all border ${activeSymptom === sym.id ? 'bg-blue-100 text-blue-700 border-blue-200 dark:bg-blue-900 dark:text-blue-300 dark:border-blue-700' : 'bg-white border-slate-200 text-slate-600 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-400'}`}
                                        >
                                            {sym.label}
                                        </button>
                                    ))}
                                </div>
                            )}
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="max-w-3xl mx-auto px-4 py-6">
                        {view === 'nutrients' ? (
                            <>
                                {/* 症状描述提示 */}
                                {activeSymptom && (
                                    <div className="mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 rounded-xl text-center text-sm font-medium animate-pulse-once">
                                        💡 {symptomMap.find(s => s.id === activeSymptom)?.desc}
                                    </div>
                                )}

                                {/* 英雄网格 */}
                                <div className="grid grid-cols-4 gap-3 sm:grid-cols-5 md:grid-cols-6">
                                    {nutrientsData.map(item => {
                                        const isDimmed = activeSymptom && !item.tags.includes(activeSymptom);
                                        const isHighlighted = activeSymptom && item.tags.includes(activeSymptom);
                                        return (
                                            <HeroCard 
                                                key={item.id} 
                                                item={item} 
                                                isDimmed={isDimmed} 
                                                isHighlighted={isHighlighted}
                                                onClick={() => setSelectedNutrient(item)}
                                            />
                                        );
                                    })}
                                </div>
                            </>
                        ) : (
                            <div className="space-y-4 animate-fadeIn">
                                <div className="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-6 text-white mb-6 shadow-lg">
                                    <h2 className="text-2xl font-bold mb-2">2026 膳食指南</h2>
                                    <p className="opacity-90 text-sm">更科学、更严格、更适合全生命周期的健康建议。</p>
                                </div>
                                {guidelinesData.map((item, index) => (
                                    <GuidelineCard key={index} item={item} isSeniorMode={isSeniorMode} />
                                ))}
                            </div>
                        )}
                        
                        <div className="mt-12 text-center pb-6">
                            <p className="text-xs text-slate-400 dark:text-slate-600">
                                数据来源: NIH, Mayo Clinic, USDA.
                                <br/>仅供参考，不作为医疗诊断依据。
                            </p>
                        </div>
                    </main>

                    {/* 弹窗层 */}
                    {selectedNutrient && (
                        <DetailModal 
                            item={selectedNutrient} 
                            onClose={() => setSelectedNutrient(null)} 
                            isSeniorMode={isSeniorMode}
                            setIsSeniorMode={setIsSeniorMode}
                        />
                    )}

                    {showSources && <SourcesModal onClose={() => setShowSources(false)} isSeniorMode={isSeniorMode} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
